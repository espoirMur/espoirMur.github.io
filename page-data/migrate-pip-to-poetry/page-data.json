{"componentChunkName":"component---src-templates-blog-post-js","path":"/migrate-pip-to-poetry/","result":{"data":{"site":{"siteMetadata":{"title":"My ideas' home"}},"markdownRemark":{"id":"bae4dd11-0aae-5ebe-abe1-81554ad3e736","excerpt":"I have recently stumbled across poetry new dependency management for python and decided to give it a try. I have been a die hard fan of pip and had used it inâ€¦","html":"<p>I have recently stumbled across <a href=\"https://python-poetry.org/\">poetry</a> new dependency management for python and decided to give it a try.</p>\n<p>I have been a die hard fan of pip and had used it in most of my projects before I discovered poetry. Furthermore, I had heard about pyenv in the past but was reluctant to use it in my projects for preference reasons. Since Python dependency management is an interesting topic, I would like to explain the difference in another article such as <a href=\"https://github.com/pypa/pip\">pip</a> vs <a href=\"https://github.com/pyenv/pyenv\">pyenv</a> vs <a href=\"https://github.com/python-poetry/poetry\">petry</a>.</p>\n<p>When I discovered poetry and tested it, I fell in love with it.</p>\n<h2>What is poetry?</h2>\n<p>Although I will be talking about girlfriends, falling in love , and breakups in this article, the poetry I am talking about is not about love, prose, poems, or Shakespeare.</p>\n<p><em>Poetry is a tool for <strong>dependency management</strong> and <strong>packaging</strong> in Python. It allows you to declare the libraries your project depends on and it will manage (install/update) them for you.</em> It supports Python 2.7 and 3.5+</p>\n<p>If you work with python and install packages you should be familiar with <code class=\"language-text\">pip</code> my old girlfriend.</p>\n<h2>Why we should use poetry in lieu of pip?</h2>\n<p>After 2 weeks of usages and successful migration of five personal projects from <code class=\"language-text\">pip</code> to <code class=\"language-text\">poetry</code>, I can choose poetry because :</p>\n<ul>\n<li>It has a good dependency resolver. It does the job better than PIP. Read the interesting article <a href=\"https://www.activestate.com/resources/quick-reads/python-dependencies-everything-you-need-to-know/\">www.activestate.com</a>. The author explicitly said</li>\n</ul>\n<blockquote>\n<p>Unfortunately, pip makes no attempt to resolve dependency conflicts. For example, if you install two packages, package A may require a different version of a dependency than package B requires.</p>\n</blockquote>\n<ul>\n<li>And another advantage I found is that anytime you add a new dependency to the project poetry update for you the <code class=\"language-text\">pyproject.toml</code> with the new top-level dependency, it, therefore, avoid you to do <code class=\"language-text\">pip freeze</code> to generate a new requirement file for your project.</li>\n<li>You can use the same tool to build and publish your packages. And it is easy to do so. I my opinion this is why I think <code class=\"language-text\">poetry</code> outweighed <code class=\"language-text\">pip</code></li>\n</ul>\n<p>In my opinion, I think <code class=\"language-text\">poetry</code> outweigh <code class=\"language-text\">pip</code> in many aspects. It is like pip but on steroids</p>\n<p>In the following sections, I will guide you on how to migrate an existing project from pip to poetry.</p>\n<h2>Installing Poetry in your system</h2>\n<p><img src=\"https://lh5.googleusercontent.com/prDFZYFCdhOvTIpSpv8fItqiZ3GHrHEypuEhY0J2IyORNHoOwd6JlneUEUEGlcE-yRR0xVGkOUlwIeDWc5DfSCMrpJqX5m_CQxcERZ2fUzLmmOeV-dF-OYUbMAAg0t0uvxhAN-o=s0\"></p>\n<p>Installing poetry is very straightforward, if you have python installed and <code class=\"language-text\">curl</code> you can easily install it by running :</p>\n<h4>osx / linux / bashonwindows install instructions</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py <span class=\"token operator\">|</span> python -</code></pre></div>\n<h3>windows powershell install instructions</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>Invoke-WebRequest -Uri https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py -UseBasicParsing<span class=\"token punctuation\">)</span>.Content <span class=\"token operator\">|</span> python -</code></pre></div>\n<blockquote>\n<p><strong>Warning</strong>: The previous <code class=\"language-text\">get-poetry.py</code> installer is now deprecated, if you are currently using it you should migrate to the new, supported, <code class=\"language-text\">install-poetry.py</code> installer.</p>\n</blockquote>\n<blockquote>\n<p>The installer installs the <code class=\"language-text\">poetry</code> tool to Poetryâ€™s <code class=\"language-text\">bin</code> directory. This location depends on your system:</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">$HOME/.local/bin</code> for Unix</li>\n<li><code class=\"language-text\">%APPDATA%\\Python\\Scripts</code> on Windows</li>\n</ul>\n<blockquote>\n<p>If this directory is not on your <code class=\"language-text\">PATH</code>, you will need to add it manually if you want to invoke Poetry with simply <code class=\"language-text\">poetry</code>.</p>\n</blockquote>\n<blockquote>\n<p>Alternatively, you can use the full path to <code class=\"language-text\">poetry</code> to use it.</p>\n</blockquote>\n<p>There is also another version of installing it with <code class=\"language-text\">pip</code> but why would you use your ex to attract your new girlfriend? ðŸ¤”ðŸ¤ª</p>\n<p>Once everything is installed you can restart your terminal and run the following command to check the poetry version:</p>\n<p><code class=\"language-text\">poetry --version</code></p>\n<p>If installation is unsuccessfully or encountering incompatibility issues. Please heads up to <a href=\"https://github.com/python-poetry/poetry\">Github Poetry</a> to get a help, to learn more or to fire an issue.</p>\n<h2>The Migration</h2>\n<p><img src=\"https://lh4.googleusercontent.com/S09PZBBBn_Q9Vx8vpxLNP67_9HmU-JEM50KpnZZaZavhqS3y2tzfDFuvHlL59CJo_UKhtRtYyWofhx5zlUtvUbk3yO5HHsMM4rqs6xH0fCKaGWZsjlBX7T3j_R0WdPjvf1gG3U0=s0\"></p>\n<h3>Generate top-level dependencies</h3>\n<p>Before moving to the next step you need to make sure you can generate the top-level dependencies for your project, to do that you will need a package called <a href=\"https://pypi.org/project/pipdeptree/\">pipdeptree</a> . For context, the top-level dependencies are the root of your dependencies tree. What is even the dependency tree? Each package you install using <code class=\"language-text\">pip</code> has the other dependencies that rely on it. And before installing a new package it installs his top-level dependencies. For example, pandas is a package but <code class=\"language-text\">pandas</code> depends on <code class=\"language-text\">numpy</code>, if you install pandas it install also numpy as a dependent.</p>\n<p>The following command will generate only the top-level dependencies, so if you have installed pandas, it will just generate pandas and not numpy as a requirement.</p>\n<p><em>Why is this important? :</em></p>\n<p>This should be filled</p>\n<p><code class=\"language-text\">pipdeptree --warn silence | grep -E '^\\w+' > requirements-new.txt</code></p>\n<p>Once you have generated the top-level dependencies, I would suggest you deactivate your virtual environment and delete it to make the break-up complete before moving to the next steps.</p>\n<h3>Adding poetry to an existing project.</h3>\n<p>If you have a new project where you are using <code class=\"language-text\">pip</code> and have the <code class=\"language-text\">requirements.txt</code> file inside you can run the following command to initialize poetry in the project.</p>\n<p><code class=\"language-text\">poetry init</code></p>\n<p>This will prompt you to set up poetry to your existing project and asked you to give some details about your project such as the project name, the python version you want to use, and the description. It will consequently generate the <code class=\"language-text\">pyproject.toml</code> file which will contain all the details about your project as well as the top-level projects requirement and their versions.</p>\n<h3>Creating virtual environment</h3>\n<p>Poetry creates by default virtual environment in a folder called <code class=\"language-text\">~/Library/Application Support/pypoetry</code> but you can change those settings by using the following command :</p>\n<p><code class=\"language-text\">poetry config virtualenvs.in-project true</code></p>\n<p>After running that command you can run the following :</p>\n<p><code class=\"language-text\">poetry shell</code></p>\n<p>It will activate the projectâ€™s virtual environment and create a new one if the project does not have one.</p>\n<h3>Installing the requirements for your projects.</h3>\n<p>If you have the <code class=\"language-text\">requirements-news.txt</code> file resulting from the command you run on the first step, you can install all the packages in that and their corresponding version by running the following command:</p>\n<p><code class=\"language-text\">for item in $(sed -n 's/==/@/p' requirements-new.txt); do poetry add \"${item}\" ; done</code></p>\n<blockquote>\n<p>This will work only on Linux and Mac, still trying to find the exact version of it for Windows.</p>\n</blockquote>\n<p>What does that command do?\nI loop over every line of the <code class=\"language-text\">requirement-new.txt</code> file take the dependency, and just replace the <code class=\"language-text\">==</code> in the dependency with <code class=\"language-text\">@</code> and then add it with poetry.</p>\n<p>If for example in the file you have pandas==1.1.1, it will install the following with poetry <code class=\"language-text\">poetry add pandas@1.11</code></p>\n<p>  If everything goes well you should have the all the top-level packages installed with their dependencies.</p>\n<p>Once the command has successfully run and you have everything installed, you should check if your <code class=\"language-text\">pyproject.toml</code> file contains all the packages and their top-level dependencies.</p>\n<p>You can now remove the old <code class=\"language-text\">requirements.txt</code> file and the newly create <code class=\"language-text\">requirement-new.txt</code>file by running.</p>\n<p><code class=\"language-text\">rm -f requirements.*</code></p>\n<h3>A section about using poetry with conda enviroment</h3>\n<p>Some people like to have multiples girlfriend and may like to keep their old conda or pip environment. I havenâ€™t tried this approach yet , but according to<a href=\"https://github.com/python-poetry/poetry/issues/105#issuecomment-498042062\"> this issue</a> it is possible to use poetry to install packages in a python environment.</p>\n<p>You just have to configure poetry to not create a virtual environment in a project and install your packages in the conda  or pip environment.</p>\n<p>I think you can try it and let us know in comment how it goes.</p>\n<h3>Bonus, the Dockerfile.</h3>\n<p>If you have a dockerfile you can edit it and use the following docker images which use multi-stage build to install all your requirement with poetry.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM python:3.7.5 AS base\nLABEL maintainer=\"Espoir Murhabazi &lt; first_name.second_name[:3] on gmail.com>\"\n\nENV  PYTHONUNBUFFERED=1  \\\nPYTHONDONTWRITEBYTECODE=1  \\\nPIP_NO_CACHE_DIR=off  \\\nPIP_DISABLE_PIP_VERSION_CHECK=on  \\\nPIP_DEFAULT_TIMEOUT=100  \\\nPOETRY_HOME=\"/opt/poetry\"  \\\nPOETRY_VIRTUALENVS_IN_PROJECT=true  \\\nPOETRY_NO_INTERACTION=1  \\\nPYSETUP_PATH=\"/opt/pysetup\"  \\\nVENV_PATH=\"/opt/pysetup/.venv\"\n\nENV  PATH=\"$POETRY_HOME/bin:$VENV_PATH/bin:$PATH\"\n\nFROM  base  AS  python-deps\n\nRUN  apt-get  update  \\\n\n&amp;&amp;  apt-get  install  --no-install-recommends  -y  \\\n\ncurl  \\\n\nbuild-essential\n# Install Poetry - respects $POETRY_VERSION &amp; $POETRY_HOME\nENV POETRY_VERSION=1.1.7\n\nRUN curl -sSL https://raw.githubusercontent.com/sdispater/poetry/master/get-poetry.py | python\nWORKDIR $PYSETUP_PATH\n\nCOPY ./poetry.lock ./pyproject.toml ./\nRUN poetry install --no-dev\nFROM base AS runtime\nCOPY --from=python-deps $POETRY_HOME $POETRY_HOME\nCOPY --from=python-deps $PYSETUP_PATH $PYSETUP_PATH\nRUN useradd -ms /bin/bash espy\nCOPY . /home/espy\nWORKDIR /home/espy\nUSER espy\nCMD [\" you command \"]</code></pre></div>\n<p>Basically, what the docker file does, it uses a multi-stage build to first install the packages in the first step and copy only the packages installed in the second as well as the project repository. One of the advantages of the multi-stage build is that it uses only the necessary files your project needs and therefore reduce the memory of your docker container.</p>\n<p>You can learn more about multi-stage build using the <a href=\"%5Bhttps://pythonspeed.com/articles/multi-stage-docker-python/%5D(https://pythonspeed.com/articles/multi-stage-docker-python/)\">following tutorial.</a></p>\n<h2>Conclusion</h2>\n<p>And the story of my break up comes to an end. As you may know, all separations are not smooth, sometimes the daemons of your old girlfriend come and start causing troubles in your new relationship. So if you find any issue during this break-up, feel free to let me know in the comment I will try to help you as much as I can ðŸ¤”.</p>","frontmatter":{"title":"How I break up with pip and fall in love with poetry my new girlfriend.","date":"17 October, 2021","description":"How to migrate a python project from pip to poetry","featuredimage":{"src":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAWbKyK5HVFL/xAAZEAEBAQADAAAAAAAAAAAAAAACAQMEEiP/2gAIAQEAAQUCmvSO2thK8i0aJemeZY//xAAXEQEBAQEAAAAAAAAAAAAAAAABAhAS/9oACAEDAQE/AajkHP/EABcRAQADAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8BjVP/xAAZEAEBAQADAAAAAAAAAAAAAAABABESIXH/2gAIAQEABj8CNLtt42F5C3//xAAcEAEBAQABBQAAAAAAAAAAAAABEQAhMUFRYXH/2gAIAQEAAT8hXiCHjtdYMA0NHL+5HCPrUanQGJ7mb//aAAwDAQACAAMAAAAQSB//xAAWEQEBAQAAAAAAAAAAAAAAAAAAEWH/2gAIAQMBAT8Q0Va//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxDolov/xAAeEAEAAQQCAwAAAAAAAAAAAAABEQAhMUFhkVGhsf/aAAgBAQABPxAtkJSWgn71VhWwIQhsc0FbMuid+ZNRSLorDhwd0kgOSyBJ7pK8tma//9k=","aspectRatio":1.4970760233918128,"src":"/static/ab7833edb30db95015eaafa37290324a/f9913/picture-pip-poetry.jpg","srcSet":"/static/ab7833edb30db95015eaafa37290324a/07af2/picture-pip-poetry.jpg 256w,\n/static/ab7833edb30db95015eaafa37290324a/49b36/picture-pip-poetry.jpg 512w,\n/static/ab7833edb30db95015eaafa37290324a/f9913/picture-pip-poetry.jpg 750w","sizes":"(max-width: 750px) 100vw, 750px"}}},"alt":"Migrating pip to poetry "}}}},"pageContext":{"slug":"/migrate-pip-to-poetry/","previous":{"fields":{"slug":"/career-guide-rdc/"},"frontmatter":{"title":"Mots d'un grand frÃ¨re  Ã  ses petits frÃ¨re qui debutent avec la programmation"}},"next":null}},"staticQueryHashes":["4211413508","63159454"]}