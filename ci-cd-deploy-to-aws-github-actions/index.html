<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/styles.0194413585df59861852.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;text-shadow:0 1px #fff}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.navigation-links{text-align:right;text-decoration:none}.navigation-links li{color:#eee;display:inline-block;padding:10px 20px;border-radius:20px;-webkit-transition:all .8s;transition:all .8s;text-decoration:none}.navigation-links li.active{text-decoration:underline}.navigation-links li:hover{color:#eee;cursor:pointer;text-decoration:underline}body{background-color:#22264a;background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEyMCI+PGRlZnM+PHBhdHRlcm4gcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgaWQ9ImMiIHdpZHRoPSI2MCIgaGVpZ2h0PSIxMjAiIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCA1IDEwIj48cGF0aCBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzI5MjkyOSIgc3Ryb2tlLXdpZHRoPSIwLjA5IiBkPSJNLTIsMUw3LDEwTS0yLDZMNywxNU0tMiwtNEw3LDUiLz48L3BhdHRlcm4+PHBhdHRlcm4gcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgaWQ9ImMyIiB3aWR0aD0iNjAiIGhlaWdodD0iMTIwIiB4PSIxMDAlIiB5PSIwIiB2aWV3Qm94PSIwIDAgNSAxMCI+PHBhdGggZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMyOTI5MjkiIHN0cm9rZS13aWR0aD0iMC4wOSIgZD0iTTcsMUwtMiwxME03LDZMLTIsMTVNNywtNEwtMiw1Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iNTAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjYykiLz48cmVjdCB4PSI1MCUiIHdpZHRoPSI1MCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNjMikiLz48L3N2Zz4=");margin:0;padding:0;overflow-x:hidden;height:100%;font-family:Lato,Helvetica,arial,sans-serif;font-weight:300;font-size:20px;line-height:1.45;color:#eee;color:hsla(0,0%,100%,.85)}#container{padding-top:50px}#content{max-width:43em;padding:10px;margin:0 auto}.subhead{font-size:1.2em;font-weight:300;line-height:1.5}li,p{font-size:1.7em}a{box-shadow:none;font-weight:700;text-decoration:none;color:#fff}a:hover{text-decoration:underline}p#pleft,p#pright{max-width:20em;float:left}ul{clear:both}html{font-size:62.5%}body{font-size:1em}@media (min-width:600px){html{font-size:80%}}@media (min-width:880px){html{font-size:120%}li,p{font-size:1em}p#pright{margin-left:3em}}.my-details{display:flex;flex-direction:row;flex-wrap:wrap}.my-details img{flex-grow:0;flex-shrink:0;width:150px;height:140px;border-radius:50%;background-repeat:no-repeat;background-position:50%;background-size:cover;margin-left:auto;margin-top:5px;margin-bottom:5px}.my-name{padding-left:5px;font-size:4.8em;font-weight:100;text-transform:uppercase}@media (max-width:768px){.my-details img{margin-left:-245px}.my-name{margin-top:150px;margin-left:20px}}@media (max-width:560px){.my-details img{margin-left:-215px}}@media (max-width:320px){.my-details img{margin-left:-180px}.my-name{font-size:3.5em;margin-top:150px;margin-left:20px}}</style><meta name="generator" content="Gatsby 2.18.12"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a5cff9604d0fdc6a2a4b5cbbc637b89f"/><title data-react-helmet="true">How to use the AWS Python CDK to create an infrastructure on ECS. | My ideas&#x27; home</title><meta data-react-helmet="true" name="description" content="Recently at work, we decided to build a CI/CD pipeline that deploys our application directly to AWS. I had never worked with AWS, and it was a missing point on…"/><meta data-react-helmet="true" property="og:title" content="How to use the AWS Python CDK to create an infrastructure on ECS."/><meta data-react-helmet="true" property="og:description" content="Recently at work, we decided to build a CI/CD pipeline that deploys our application directly to AWS. I had never worked with AWS, and it was a missing point on…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Espoir Murhabazi"/><meta data-react-helmet="true" name="twitter:title" content="How to use the AWS Python CDK to create an infrastructure on ECS."/><meta data-react-helmet="true" name="twitter:description" content="Recently at work, we decided to build a CI/CD pipeline that deploys our application directly to AWS. I had never worked with AWS, and it was a missing point on…"/><script data-react-helmet="true" type="application/ld+json">{"@context":"https://murhabazi.com","@type":"Personal","url":"https://murhabazi.com","name":"Espoir Murhabazi Website","contactPoint":{"@type":"ContactPoint","telephone":"+250 78 48 3 48 36","contactType":"Personal number"}}</script><link rel="preconnect" href="https://murhabazi.matomo.cloud"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-1b3a0f7086fc482a275c.js"/><link as="script" rel="preload" href="/app-d5c97cf11e79c7a049f0.js"/><link as="script" rel="preload" href="/styles-56e7429501300363e862.js"/><link as="script" rel="preload" href="/commons-b6e47ce249ec6e1fe58d.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-39ee6b0f240275c01afb.js"/><link as="fetch" rel="preload" href="/page-data/ci-cd-deploy-to-aws-github-actions/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><nav class="navigation"><div class="container"><ul class="navigation-links"><li> <a href="/">Home</a> </li><li> <a href="/blog">Blog</a> </li><li><a target="_blank" href="https://drive.google.com/file/d/14yle0nyGH_Kyk7L67nvqwl90FobvY7W0/view?usp=sharing" rel="noopener noreferrer">Resume</a></li></ul></div></nav><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/blog">My ideas&#x27; home</a></h3></header><main><main></main> <article><header><h1 style="margin-top:1.75rem;margin-bottom:0">How to use the AWS Python CDK to create an infrastructure on ECS.<!-- --> </h1> <p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">26 February, 2021<!-- --> </p> </header> <section><p>Recently at work, we decided to build a CI/CD pipeline that deploys our application directly to AWS. I had never worked with AWS, and it was a missing point on my CV which demonstrates that I have some DevOps skills. I decided to search for some tutorials online and I was not lucky to get what we needed at work. I decided to write this guide by getting something working from various tutorials I found online.</p>
<h3>What you will learn from this series.</h3>
<p>In this 3 parts tutorial, we will learn how to Create an AWS architecture where you can deploy an application, how to convert a docker-compose file in a Task Definition and how to deploy a Task Definition to an AWS Architecture using GitHub Actions.</p>
<h3>Who is this series for ?</h3>
<p>This tutorial is for developers who are familiar with docker and have an application with docker-compose. Although the series was written by a Python developer and using Python, the concepts can be applied to other programming languages.</p>
<h3>Which application will we deploy?</h3>
<p>In this tutorial, we will deploy a Python application that has a celery worker, a celery scheduler, and a Redis database for task messaging and task queues.</p>
<p>I will not talk about celery and task queues and how to use those tools but you can get start with them <a href="%5Bhttps://medium.com/analytics-vidhya/python-celery-distributed-task-queue-demystified-for-beginners-to-professionals-part-1-b27030912fea%5D(https://medium.com/analytics-vidhya/python-celery-distributed-task-queue-demystified-for-beginners-to-professionals-part-1-b27030912fea)">here</a>, and to get started with docker you can use <a href="https://dev.to/javascriptcoff1/what-is-docker-3be2">this one</a> ,and <a href="https://adamtheautomator.com/docker-compose-tutorial/">this one</a> to be familiar with docker-compose.</p>
<p>This series is not based on any popular Python web framework such as Django, Flask, or FastAPi but you can adapt this tutorial to them and I am sure it will work like a charm.</p>
<p>The application skeleton can be downloaded from <a href="https://github.com/espoirMur/deploy_python_to_aws_github_actions">this link</a> to get started.</p>
<p>In this first part of the tutorial, we will learn how to create the Cloudformation stack.</p>
<h3>What is AWS CloudFormation?</h3>
<p>From <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">the official documentation</a>, Cloudformation is defined as :</p>
<blockquote>
<p>AWS CloudFormation is a service that helps you model and set up your Amazon Web Services resources so that you can spend less time managing those resources and more time focusing on your applications that run in AWS. You create a template that describes all the AWS resources that you want (like Amazon EC2 instances or Amazon RDS DB instances), and CloudFormation takes care of provisioning and configuring those resources for you. You don’t need to individually create and configure AWS resources and figure out what’s dependent on what; CloudFormation handles all of that.</p>
</blockquote>
<h3>Creating the AWS Architecture</h3>
<p>Make sure that you have created an AWS account and you have your credentials; the access key, and the application secret key.</p>
<p>Most of the services used in this tutorial are available within an AWS free tier.</p>
<p>We will deploy our application using the AWS ECS Fargate launch type which will pull docker images from the Elastic Container Registry aka ECR.</p>
<h4>Why Fargate and not EC2?</h4>
<p><img src="https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif" alt="Alt Text"></p>
<p>AWS provides us basically two launch types which are the Fargate launch type and the EC2.</p>
<p>Amazon Elastic Compute Cloud (Amazon EC2) provides scalable computing capacity in the Amazon Web Services (AWS) Cloud. Using Amazon EC2 eliminates the need to invest in hardware upfront, so you can develop and deploy applications faster. You can use Amazon EC2 to launch as many or as few virtual servers as you need. It allows you to configure security and networking, and manage storage yourself. With EC2 you don’t have to worry about the hardware, the hardware is managed by AWS.</p>
<p>AWS Fargate is a technology that you can use with Amazon ECS to run <a href="https://aws.amazon.com/what-are-containers">containers</a> without having to manage servers or clusters of Amazon EC2 instances. The advantage of Fargate over EC2 is the fact that you don’t have to configure, provision, or scale cluster instances and don’t have to worry about the virtual machines.</p>
<p>In a nutshell :</p>
<p>With a virtual machine, someone still has to manage the hardware, but with EC2 that someone is AWS and you never even see the hardware.</p>
<p>With ECS on EC2, someone still has to manage the instances, but with ECS on Fargate that someone is AWS and you never even see the EC2 instances.</p>
<p>ECS has a “launch type” of either EC2 (if you want to manage the instances yourself) or Fargate (if you want AWS to manage the instances). <a href="https://www.reddit.com/r/aws/comments/dvl601/eli5_aws_fargate/f7ddkup?utm_source=share&#x26;utm_medium=web2x&#x26;context=3">Source</a>.</p>
<h4>The objects we need :</h4>
<p>To deploy the application we need the following objects: a cluster, a service, a task definition with containers definition, cloud watch for logging, and IAM roles. The below picture illustrates how those AWS objects interact with each other.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/k5bcp5zjq6ssob06mgyt.png" alt="Alt Text"></p>
<p>Let us define some of those objects and then we will investigate how to create a stack, containing them, using Python cdk.</p>
<ul>
<li><strong>A cluster</strong>: It is a logical group of container instances that ECS can use for deploying Docker containers. It provides computing power to run application container instances. In practice, a cluster is usually attached to an AWS Instance.</li>
<li><strong>A service</strong>: It enables us to run and maintain a specified number of instances of a task definition simultaneously in an Amazon ECS cluster. ie. It helps us run single or multiple containers all using the same Task Definition.</li>
<li><strong>The task definition</strong>: A task definition is a specification. You use it to define one or more containers (with image URIs) that you want to run together, along with other details such as environment variables, CPU/memory requirements, etc. The task definition doesn’t actually run anything, it’s a description of how things will be set up when something does run. The task definition shares some similarities with the docker-compose file. In the second part of this tutorial, we will convert a docker-compose file into a task definition.</li>
<li><strong>A task</strong>: A task is an actual thing that is running. ECS uses the task definition to run the task; it downloads the container images, configures the runtime environment based on other details in the task definition. You can run one or many tasks for any given task definition. Each running task is a set of one or more running containers - containers in a task all run on the same instance.</li>
<li><strong>cloudwatch</strong>: CloudWatch is a monitoring service, we are using it in this stack to get and visualize logs from the docker containers.</li>
</ul>
<p>With all the objects described, we can now learn how to create them using the Python CDK.</p>
<h4>Creating the architecture:</h4>
<p>To build the infrastructure, we will leverage the <a href="https://aws.amazon.com/cdk/">AWS Cloud Development Kit (CDK)</a>. If you are new to CDK, see <a href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html">Getting Started with AWS CDK</a>, it is simple and straightforward to install. In this post, we will be using the CDK with Python 3.7. Another alternative to the CDK is to create the application via the AWS console. However, I found the CDK to be the simplest approach because it allows you to have control over the code you are writing.</p>
<p>After installing the CDK check if it is working with the following command:</p>
<ul>
<li><code class="language-text">cdk --version</code> should output your CDK version.</li>
</ul>
<h5>Initializing the AWS CLI :</h5>
<p>Make sure you have AWS CLI installed on your computer. <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">Configure your AWS CLI</a> with an IAM user that has permissions to create the resources (VPC, ECS, ECR, IAM Role) described in the template below. After the configuration you should have the AWS keys stored in your computer at the following location :</p>
<ul>
<li><code class="language-text">~/.aws/credentials</code>: if you are using Mac or Linux</li>
<li><code class="language-text">C:\Users\</code>USERNAME<code class="language-text">\.aws\config</code>: if you are on Windows</li>
</ul>
<p>The content of that file should look like this one:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">[default]

region=your region

aws_access_key_id = *********************************

aws_secret_access_key = ******************************</code></pre></div>
<p>With the credentials, the cli client and the CDK installed let us move to the second step about creating the architecture.</p>
<h4>Initializing The CDK Project :</h4>
<p>To initialize the CDK we will create a new Python project which will contain the code to create the architecture.</p>
<p><em>Step 1</em>: Creating the project</p>
<p>Run the following command to create a new CDK project:</p>
<p><code class="language-text">mkdir ecs-devops-cdk</code></p>
<p>Enter the project using:</p>
<p><code class="language-text">cd ecs-devops-cdk</code></p>
<p>Or if you are using VSCode you can open the project with vs code using:</p>
<p><code class="language-text">code ecs-devops-cdk</code></p>
<ul>
<li><em>Step 2</em>: Initialize the python CDK project :</li>
</ul>
<p>To initialize the CDK project run the following command:</p>
<p><code class="language-text">cdk init --language python</code></p>
<p>The command will create a new python CDK project and we will be editing it in the next step to build our stack.</p>
<p>After a quick look you should see a structure like this in your project:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">.</span>

├── README.md

├── app.py

├── cdk.json

├── ecs_devops_cdk

│ ├── __init__.py

│ └── ecs_devops_cdk_stack.py

├── requirements.txt

├── setup.py

└── source.bat</code></pre></div>
<ul>
<li><em>Step 3</em>: activate virtual environment :</li>
</ul>
<p>You can activate your virtual environment using the following command :</p>
<p>On mac and linux : <code class="language-text">source .env/bin/activate</code></p>
<p>For windows : <code class="language-text">.env\Scripts\activate.bat</code></p>
<ul>
<li><em>step 4</em>: Installing dependencies:</li>
</ul>
<p>With the virtual environment created we can now install the dependencies :</p>
<p><code class="language-text">pip install -r requirements.txt</code>and<code class="language-text">pip install aws_cdk.aws_ec2 aws_cdk.aws_ecs aws_cdk.aws_ecr aws_cdk.aws_iam</code></p>
<p>With the project initialized we can now move to the next step where we will be creating our components.</p>
<h4>Creating the objects :</h4>
<p>We can now move to the stack creation step</p>
<p>If you open the file under <code class="language-text">ecs_devops_cdk/ecs_devops_cdk_stack.py</code> you should be able to see the followings :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> aws_cdk <span class="token keyword">import</span> core

<span class="token keyword">class</span> <span class="token class-name">EcsDevopsCdkStack</span><span class="token punctuation">(</span>core<span class="token punctuation">.</span>Stack<span class="token punctuation">)</span><span class="token punctuation">:</span>

<span class="token keyword">def</span> <span class="token function">__init__</span> <span class="token punctuation">(</span>self<span class="token punctuation">,</span> scope<span class="token punctuation">:</span> core<span class="token punctuation">.</span>Construct<span class="token punctuation">,</span> construct_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>

<span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> __init__ <span class="token punctuation">(</span>scope<span class="token punctuation">,</span> construct_id<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></code></pre></div>
<p>It is basically a class that will contain the code defining our stack.</p>
<p><strong>step 1</strong>: Import the core functionality</p>
<p>Edit the first line to import the code we need to create the following stack:</p>
<p>`python</p>
<p>from aws<em>cdk import (core, aws</em>ecs as ecs, aws<em>ecr as ecr, aws</em>ec2 as ec2, aws<em>iam as iam, aws</em>logs)`</p>
<p><strong>step 2</strong>: Create the container repository</p>
<p>To create a container repository you can use the following command :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">ecr_repository <span class="token operator">=</span> ecr<span class="token punctuation">.</span>Repository<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-repository"</span><span class="token punctuation">,</span> repository_name<span class="token operator">=</span><span class="token string">"ecs-devops-repository"</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>step 3</strong>: Creating the VPC :</p>
<p>We can either create a vpc or use an existing vpc. To create a vpc use can add the following code the <code class="language-text">__init__</code> method.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">vpc <span class="token operator">=</span> ec2<span class="token punctuation">.</span>Vpc<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-vpc"</span><span class="token punctuation">,</span> max_azs<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre></div>
<p>You can also use an existing vpc , if that is the case for you use the following lines:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">vpc <span class="token operator">=</span> ec2<span class="token punctuation">.</span>Vpc<span class="token punctuation">.</span>from_lookup<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-vpc"</span><span class="token punctuation">,</span>vpc_id<span class="token operator">=</span><span class="token string">'vpc-number'</span><span class="token punctuation">)</span></code></pre></div>
<p>For this, you need the vpc name and the corresponding id.</p>
<p><em>step 4:</em> Cluster Creation :</p>
<p>With the vpc created we can attach the cluster to it . To create the cluster we can use the following code :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">cluster <span class="token operator">=</span> ecs<span class="token punctuation">.</span>Cluster<span class="token punctuation">(</span>self<span class="token punctuation">,</span>

<span class="token string">"ecs-devops-cluster"</span><span class="token punctuation">,</span>

cluster_name<span class="token operator">=</span><span class="token string">"ecs-devops-cluster"</span><span class="token punctuation">,</span>

vpc<span class="token operator">=</span>vpc<span class="token punctuation">)</span></code></pre></div>
<p><em>step 5:</em> Creating the Role:</p>
<p>Let us create the role, the role will give the service permission to perform tasks.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">execution_role <span class="token operator">=</span> iam<span class="token punctuation">.</span>Role<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-execution-role"</span><span class="token punctuation">,</span> assumed_by<span class="token operator">=</span>iam<span class="token punctuation">.</span>ServicePrincipal<span class="token punctuation">(</span><span class="token string">"ecs-tasks.amazonaws.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> role_name<span class="token operator">=</span><span class="token string">"ecs-devops-execution-role"</span><span class="token punctuation">)</span></code></pre></div>
<p>With the execution role created we can attach policy to it to give it the permission it needs.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">execution_role<span class="token punctuation">.</span>add_to_policy<span class="token punctuation">(</span>iam<span class="token punctuation">.</span>PolicyStatement<span class="token punctuation">(</span> effect<span class="token operator">=</span>iam<span class="token punctuation">.</span>Effect<span class="token punctuation">.</span>ALLOW<span class="token punctuation">,</span> resources<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> actions<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"ecr:GetAuthorizationToken"</span><span class="token punctuation">,</span> <span class="token string">"ecr:BatchCheckLayerAvailability"</span><span class="token punctuation">,</span> <span class="token string">"ecr:GetDownloadUrlForLayer"</span><span class="token punctuation">,</span> <span class="token string">"ecr:BatchGetImage"</span><span class="token punctuation">,</span> <span class="token string">"logs:CreateLogStream"</span><span class="token punctuation">,</span> <span class="token string">"logs:PutLogEvents"</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>With the IAM role created we can attach a task definition to it</p>
<p><em>Step 6</em>: Creating the task definition :</p>
<p>Here is the code we used to create the task definition ;</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">task_definition <span class="token operator">=</span> ecs<span class="token punctuation">.</span>FargateTaskDefinition<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-task-definition"</span><span class="token punctuation">,</span> execution_role<span class="token operator">=</span>execution_role<span class="token punctuation">,</span> family<span class="token operator">=</span><span class="token string">"ecs-devops-task-definition"</span><span class="token punctuation">)</span></code></pre></div>
<p>And the container :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">container <span class="token operator">=</span> task_definition<span class="token punctuation">.</span>add_container<span class="token punctuation">(</span><span class="token string">"ecs-devops-sandbox"</span><span class="token punctuation">,</span> image<span class="token operator">=</span>ecs<span class="token punctuation">.</span>ContainerImage<span class="token punctuation">.</span>from_registry<span class="token punctuation">(</span><span class="token string">"amazon/amazon-ecs-sample"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></code></pre></div>
<p>In the code above, we are initially specifying the Task Definition to run with an example container from a public AWS sample registry. This sample container is replaced with our application container when our CI/CD pipeline updates the Task Definition. We are using the container from the sample registry to allow the Service to stabilize before any application container images are added to our ECR repository.</p>
<p>With the task definition created we can attach a service that will be running it.</p>
<p><em>step 7:</em> Creating the service :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">service <span class="token operator">=</span> ecs<span class="token punctuation">.</span>FargateService<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-service"</span><span class="token punctuation">,</span> cluster<span class="token operator">=</span>cluster<span class="token punctuation">,</span> task_definition<span class="token operator">=</span>task_definition<span class="token punctuation">,</span> service_name<span class="token operator">=</span><span class="token string">"ecs-devops-service"</span><span class="token punctuation">)</span></code></pre></div>
<p>The service uses the task definition and you can see it is attached to our created cluster.</p>
<p>PS: When your AWS instance is in a public subnet , you need to auto-assign public IP addresses to the containers to grant them internet access. This will help your service to download a docker image from a public repository. In that case, you can use the following code when creating the service. :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">service <span class="token operator">=</span> ecs<span class="token punctuation">.</span>FargateService<span class="token punctuation">(</span>self<span class="token punctuation">,</span>

<span class="token string">"service-name"</span><span class="token punctuation">,</span>

cluster<span class="token operator">=</span>cluster<span class="token punctuation">,</span>

task_definition<span class="token operator">=</span>task_definition<span class="token punctuation">,</span>

service_name<span class="token operator">=</span><span class="token string">"service-name"</span><span class="token punctuation">,</span>

assign_public_ip<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token comment"># this is important</span>

security_groups<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">list</span> of security groups <span class="token punctuation">,</span> also important<span class="token punctuation">]</span><span class="token punctuation">,</span>

vpc_subnets<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">list</span> of subnets<span class="token punctuation">]</span>

<span class="token punctuation">)</span></code></pre></div>
<p>Note the assign<em>public</em>ip , the security group and the VPC subnets.</p>
<p><em>Step 8</em>: Creating the cloudwatch Log group:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">log_group <span class="token operator">=</span> aws_logs<span class="token punctuation">.</span>LogGroup<span class="token punctuation">(</span>

  

self<span class="token punctuation">,</span>

  

<span class="token string">"ecs-devops-service-logs-groups"</span><span class="token punctuation">,</span>

  

log_group_name<span class="token operator">=</span><span class="token string">"ecs-devops-service-logs"</span><span class="token punctuation">)</span></code></pre></div>
<p>As stated before we will be transferring the docker logs to our log group created in Cloudwatch.</p>
<p>With all the objects created let us make sure that we have all the ingredients for our stack in the following updated file.</p>
<p><code class="language-text">ecs_devops_cdk/ecs_devops_cdk_stack.py</code></p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> aws_cdk <span class="token keyword">import</span> <span class="token punctuation">(</span>core<span class="token punctuation">,</span> aws_ecs <span class="token keyword">as</span> ecs<span class="token punctuation">,</span> aws_ecr <span class="token keyword">as</span> ecr<span class="token punctuation">,</span> aws_ec2 <span class="token keyword">as</span> ec2<span class="token punctuation">,</span> aws_iam <span class="token keyword">as</span> iam<span class="token punctuation">,</span> aws_logs<span class="token punctuation">)</span>

  

<span class="token keyword">class</span> <span class="token class-name">EcsDevopsCdkStack</span><span class="token punctuation">(</span>core<span class="token punctuation">.</span>Stack<span class="token punctuation">)</span><span class="token punctuation">:</span>

<span class="token keyword">def</span> <span class="token function">__init__</span> <span class="token punctuation">(</span>self<span class="token punctuation">,</span> scope<span class="token punctuation">:</span> core<span class="token punctuation">.</span>Construct<span class="token punctuation">,</span> construct_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>

  

<span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> __init__ <span class="token punctuation">(</span>scope<span class="token punctuation">,</span> construct_id<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

ecr_repository <span class="token operator">=</span> ecr<span class="token punctuation">.</span>Repository<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-repository"</span><span class="token punctuation">,</span> repository_name<span class="token operator">=</span><span class="token string">"ecs-devops-repository"</span><span class="token punctuation">)</span>

vpc <span class="token operator">=</span> ec2<span class="token punctuation">.</span>Vpc<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-vpc"</span><span class="token punctuation">,</span> max_azs<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

cluster <span class="token operator">=</span> ecs<span class="token punctuation">.</span>Cluster<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-cluster"</span><span class="token punctuation">,</span> cluster_name<span class="token operator">=</span><span class="token string">"ecs-devops-cluster"</span><span class="token punctuation">,</span> vpc<span class="token operator">=</span>vpc<span class="token punctuation">)</span>

execution_role <span class="token operator">=</span> iam<span class="token punctuation">.</span>Role<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-execution-role"</span><span class="token punctuation">,</span> assumed_by<span class="token operator">=</span>iam<span class="token punctuation">.</span>ServicePrincipal<span class="token punctuation">(</span><span class="token string">"ecs-tasks.amazonaws.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> role_name<span class="token operator">=</span><span class="token string">"ecs-devops-execution-role"</span><span class="token punctuation">)</span>

execution_role<span class="token punctuation">.</span>add_to_policy<span class="token punctuation">(</span>iam<span class="token punctuation">.</span>PolicyStatement<span class="token punctuation">(</span>

effect<span class="token operator">=</span>iam<span class="token punctuation">.</span>Effect<span class="token punctuation">.</span>ALLOW<span class="token punctuation">,</span> resources<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

actions<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"ecr:GetAuthorizationToken"</span><span class="token punctuation">,</span>

<span class="token string">"ecr:BatchCheckLayerAvailability"</span><span class="token punctuation">,</span>

<span class="token string">"ecr:GetDownloadUrlForLayer"</span><span class="token punctuation">,</span>

<span class="token string">"ecr:BatchGetImage"</span><span class="token punctuation">,</span>

  

<span class="token string">"logs:CreateLogStream"</span><span class="token punctuation">,</span>

  

<span class="token string">"logs:PutLogEvents"</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>

  

task_definition <span class="token operator">=</span> ecs<span class="token punctuation">.</span>FargateTaskDefinition<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-task-definition"</span><span class="token punctuation">,</span> execution_role<span class="token operator">=</span>execution_role<span class="token punctuation">,</span>

family<span class="token operator">=</span><span class="token string">"ecs-devops-task-definition"</span><span class="token punctuation">)</span>

container <span class="token operator">=</span> task_definition<span class="token punctuation">.</span>add_container<span class="token punctuation">(</span><span class="token string">"ecs-devops-sandbox"</span><span class="token punctuation">,</span> image<span class="token operator">=</span>ecs<span class="token punctuation">.</span>ContainerImage<span class="token punctuation">.</span>from_registry<span class="token punctuation">(</span><span class="token string">"amazon/amazon-ecs-sample"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

service <span class="token operator">=</span> ecs<span class="token punctuation">.</span>FargateService<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-service"</span><span class="token punctuation">,</span> cluster<span class="token operator">=</span>cluster<span class="token punctuation">,</span> task_definition<span class="token operator">=</span>task_definition<span class="token punctuation">,</span> service_name<span class="token operator">=</span><span class="token string">"ecs-devops-service"</span><span class="token punctuation">)</span>

log_group <span class="token operator">=</span> aws_logs<span class="token punctuation">.</span>LogGroup<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"ecs-devops-service-logs-groups"</span><span class="token punctuation">,</span> log_group_name<span class="token operator">=</span><span class="token string">"ecs-devops-service-logs"</span><span class="token punctuation">)</span></code></pre></div>
<p>Before creating the stack open the file <code class="language-text">app.py</code></p>
<p>You should see something like this :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> aws_cdk <span class="token keyword">import</span> core

<span class="token keyword">from</span> ecs_devops_cdk<span class="token punctuation">.</span>ecs_devops_cdk_stack <span class="token keyword">import</span> EcsDevopsCdkStack

app <span class="token operator">=</span> core<span class="token punctuation">.</span>App<span class="token punctuation">(</span><span class="token punctuation">)</span>

  

EcsDevopsCdkStack<span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"ecs-devops-cdk"</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span>synth<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>Replace the line where your stack is instantiated, 4th line, with the following :</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">EcsDevopsCdkStack<span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token string">"ecs-devops-cdk"</span><span class="token punctuation">,</span> env<span class="token operator">=</span><span class="token punctuation">{</span>

  

<span class="token string">'account'</span><span class="token punctuation">:</span> <span class="token string">" **************"</span><span class="token punctuation">,</span>

  

<span class="token string">'region'</span><span class="token punctuation">:</span> <span class="token string">"your region"</span>

  

<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>With this set; you can now create your stack. With the code created we can now run the following command to create our stack.</p>
<p><code class="language-text">cdk deploy</code></p>
<p>If everything goes well you should have your stack created. As a result, you will have a cluster, running a service that deploys a task definition, and a Cloudwatch log group created.</p>
<p>You can check your stack from the AWS console by navigating to the following <a href="https://us-east-2.console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks?filteringStatus=active&#x26;filteringText=&#x26;viewNested=true&#x26;hideStacks=false">link</a>.</p>
<p>If you want, you can check this project on GitHub <a href="https://github.com/espoirMur/ecs-devops-cdk">here</a>.</p>
<p>That is all for this first part, we managed to build our ship and added the most important objects to it.</p>
<p>We are now ready to pack containers and deliver our content to our client.</p>
<p>In the second part of this series, we will learn how to convert our docker-compose file to a task definition described in this tutorial. See you then!</p></section> <hr style="margin-bottom:1.75rem"/> <footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIEBQMG/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABxpXpmM6j0MArA//EABsQAAICAwEAAAAAAAAAAAAAAAECAxIABBET/9oACAEBAAEFAols8i8GRa3HaC+SJRkPXJPjIBb/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAACAQUAAAAAAAAAAAAAAAAAARECECEiMf/aAAgBAQAGPwJK6lm2CCobOH//xAAaEAEAAgMBAAAAAAAAAAAAAAABACERMUFR/9oACAEBAAE/IQc1DJPYyzWS64x1baP3+M1I0MvS8MQxDip//9oADAMBAAIAAwAAABBAwAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAdEAEBAQACAgMAAAAAAAAAAAABEQAhMVFhcYHB/9oACAEBAAE/EOQ9VSywuCGWe/W7ZGKMrieB+8kohxEQrn6ZggdmVaF43mp+GAiu8/M3VZJbZv/Z" alt="Espoir Murhabazi" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/8f987b034c85873917f3cecccdaa2d97/30d3a/profile-pic.jpg 1x,
/static/8f987b034c85873917f3cecccdaa2d97/66c95/profile-pic.jpg 1.5x,
/static/8f987b034c85873917f3cecccdaa2d97/aacbd/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/static/8f987b034c85873917f3cecccdaa2d97/30d3a/profile-pic.jpg 1x,
/static/8f987b034c85873917f3cecccdaa2d97/66c95/profile-pic.jpg 1.5x,
/static/8f987b034c85873917f3cecccdaa2d97/aacbd/profile-pic.jpg 2x" src="/static/8f987b034c85873917f3cecccdaa2d97/30d3a/profile-pic.jpg" alt="Espoir Murhabazi" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div> <p>Written by <strong> <!-- -->Espoir Murhabazi<!-- --> </strong> , a Engineer from DRC<!-- --> <span class="flag-icon flag-icon-cd"></span> who is currently living and working in Rwanda <span class="flag-icon flag-icon-cd"> . </span></p></div></footer> </article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li> <a rel="prev" href="/ielts-how-it-went/"> <!-- -->←<!-- -->I sat for the IELTS today , here is how it went<!-- --> </a> </li> <li> <a rel="next" href="/book-recomendations/"> <!-- -->My book recommendation to enhance your Soft Skills as a developer<!-- -->→<!-- --> </a> </li> </ul> </nav> </main><script src="https://utteranc.es/client.js" repo="espoirMur/espoirMur.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async=""></script><footer>© <!-- -->2021<!-- -->, Build by Espy Mur</footer></div></div></div><script>
    window.dev = undefined
    if (window.dev === true || !(navigator.doNotTrack === '1' || window.doNotTrack === '1')) {
      window._paq = window._paq || [];
      
      
      
      window._paq.push(['setTrackerUrl', 'https://murhabazi.matomo.cloud/piwik.php']);
      window._paq.push(['setSiteId', '1']);
      window._paq.push(['enableHeartBeatTimer']);
      window.start = new Date();

      (function() {
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src='https://murhabazi.matomo.cloud/piwik.js'; s.parentNode.insertBefore(g,s);
      })();

      if (window.dev === true) {
        console.debug('[Matomo] Tracking initialized')
        console.debug('[Matomo] matomoUrl: https://murhabazi.matomo.cloud, siteId: 1')
      }
    }
  </script><noscript><img src="https://murhabazi.matomo.cloud/piwik.php?idsite=1&rec=1&url=https://murhabazi.com/ci-cd-deploy-to-aws-github-actions/" style="border:0" alt="tracker" /></noscript><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ci-cd-deploy-to-aws-github-actions/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d5c97cf11e79c7a049f0.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-58be84fb0a4e567a4acb.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-39ee6b0f240275c01afb.js"],"component---src-components-blog-index-js":["/component---src-components-blog-index-js-51d08579108aba5ed948.js"],"component---src-pages-404-js":["/component---src-pages-404-js-96cc17a2d9b87624a478.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4fad500c9a3226a4303a.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-39ee6b0f240275c01afb.js" async=""></script><script src="/commons-b6e47ce249ec6e1fe58d.js" async=""></script><script src="/styles-56e7429501300363e862.js" async=""></script><script src="/app-d5c97cf11e79c7a049f0.js" async=""></script><script src="/webpack-runtime-1b3a0f7086fc482a275c.js" async=""></script></body></html>